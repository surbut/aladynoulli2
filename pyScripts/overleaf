% science_template.tex
% See accompanying readme.txt for copyright statement, change log etc.

%%%%%%%%%%%%%%%% START OF PREAMBLE %%%%%%%%%%%%%%%

% Basic setup. Authors shouldn't need to adjust these commands.
% It's annoying, but please do NOT strip these into a separate file.
% They need to be included in this .tex for our production software to work.

% Use the basic LaTeX article class, 12pt text
\documentclass[12pt]{article}
\usepackage{subcaption}
% Science uses Times font. If you don't have this installed (most LaTeX installations will be
% fine) or prefer the old Computer Modern fonts, comment out the following line
\usepackage{newtxtext,newtxmath}
\usepackage{setspace}
% Allow external graphics files
\usepackage{graphicx}
\usepackage{booktabs}
% Use US letter sized paper with 1 inch margins
\usepackage[letterpaper,margin=1in]{geometry}
\usepackage{tcolorbox}

% Double line spacing, including in captions
\linespread{1.5} % For some reason double spacing is 1.5, not 2.0!

% One space after each sentence
\frenchspacing

% Abstract formatting and spacing - no heading
\renewenvironment{abstract}
	{\quotation}
	{\endquotation}

% No date in the title section
\date{}

% Reference section heading
\renewcommand\refname{References and Notes}

% Figure and Table labels in bold
\makeatletter
\renewcommand{\fnum@figure}{\textbf{Figure \thefigure}}
\renewcommand{\fnum@table}{\textbf{Table \thetable}}
\makeatother

% Call the accompanying scicite.sty package.
% This formats citation numbers in Science style.
\usepackage{scicite}

% Provides the \url command, and fixes a crash if URLs or DOIs contain underscores
\usepackage{url}
\usepackage{subcaption}
%%%%%%%%%%%% CUSTOM COMMANDS AND PACKAGES %%%%%%%%%%%%

% Authors can define simple custom commands e.g. as shortcuts to save on typing
% Use \newcommand (not \def) to avoid overwriting existing commands.
% Keep them as simple as possible and note the warning in the text below.
\newcommand{\aladyn}{\texttt{ALADYNOULLI}}

%%%%%%%%%%%%%%%% TITLE AND AUTHORS %%%%%%%%%%%%%%%%

% Title of the paper.
% Keep it short and understandable by any reader of Science.
% Avoid acronyms or jargon. Use sentence case.
\def\scititle{
	\aladyn: Adaptive latent dynamics reveal personalized disease risk trajectories
}
% Store the title in a variable for reuse in the supplement (otherwise \maketitle deletes it)
\title{\bfseries \boldmath \scititle}

% Author and institution list.
% Institution numbers etc. should be hard-coded, do *not* use the \footnote command.
\author{
	Sarah Urbut$^{1\ast\dagger}$,
	Yi Ding$^{2\dagger}$,
    Tet Nakao$^{?}$,
    Alessandro Zito$^{?}$,
    Alexander Gusev$^{?}$,
     Pradeep Natarajan$^{?}$ and Giovanni Parmigiani$^{?}$
	% Additional lines of authors should be inserted using the \and command (not \\)
	% Institution list, in a slightly smaller font
	\small$^{1}$Institution 1, City & Postal Code, Country.\and
	\small$^{2}$Institution 2, City & Postal Code, Country.\and
	% Identify at least one corresponding author, with contact email address
	\small$^\ast$Corresponding author. Email: [Your Email]\and
	% Joint contributions can be indicated like this
	\small$^\dagger$These authors contributed equally to this work.
}

%%%%%%%%%%%%%%%%% END OF PREAMBLE %%%%%%%%%%%%%%%%


%%%%%%%%%%%%%%%% START OF MAIN TEXT %%%%%%%%%%%%%%%
\begin{document} 

% Insert the title and author list
\maketitle

% Abstract, in bold
\begin{abstract} \bfseries \boldmath
Understanding the complex, longitudinal interplay of multiple diseases from large-scale electronic health records (EHRs) is critical for advancing medicine but remains a significant challenge. Current methods often provide static snapshots or struggle to model intricate temporal dependencies and comorbidities. We present \aladyn (Adaptive LAtent DYNamics with BernOULLI outcomes), a probabilistic framework that identifies *time-varying latent risk signatures* from longitudinal EHR data. \aladyn leverages Gaussian processes to capture smooth temporal dynamics and employs a unique Bernoulli survival likelihood to naturally model disease co-occurrence and non-occurrence, moving beyond traditional allocation-based topic models. Crucially, it integrates genetic factors to inform individual trajectories. Applied to 500,000 individuals with up to 20 years of follow-up across diverse cohorts, \aladyn identified 21 clinically interpretable and robust disease signatures corresponding to known biological pathways. These signatures captured distinct population-level temporal patterns and revealed significant heterogeneity in individual patient trajectories, correlating strongly with genetic risk factors. Notably, \aladyn demonstrated superior performance in predicting *near-term (1-year) disease onset* compared to strong clinical baselines, highlighting its ability to dynamically update risk based on evolving health states. \aladyn provides a powerful new lens for personalized dynamic risk assessment, dissecting multimorbidity mechanisms, and informing clinical decision-making.
\end{abstract}

\section{Introduction}

Electronic health records (EHRs) provide unprecedented opportunities to study human disease across the lifespan at population scale \cite{example1}. However, the sheer volume, longitudinal nature, and inherent complexity of EHR data present formidable analytical hurdles \cite{example2}. Understanding how multiple diseases interact, progress, and manifest differently across individuals over decades requires sophisticated modeling approaches that can capture dynamic processes and underlying heterogeneity.

Traditional methods often fall short. Many rely on analyzing diseases in isolation, examining simple pairwise associations, or using predefined clinical groupings, potentially missing higher-order interactions and emergent patterns \cite{example3}. While unsupervised learning techniques like clustering or topic modeling have been applied \cite{example4}, they often provide static snapshots of disease co-occurrence. Models like Latent Dirichlet Allocation (LDA) or Age-dependent Topic Models (ATM) \cite{jiang_age-dependent_2023}, while useful for discovering latent themes, operate retrospectively: they allocate *occurred* disease events to topics, rather than prospectively modeling the *risk* of disease onset. Furthermore, their allocation mechanisms often force diseases into competition, struggling to represent the clinical reality where multiple underlying processes contribute simultaneously to an individual's health state and multiple diagnoses can occur within the same time frame. Capturing the smooth, continuous evolution of risk and integrating individual-level factors like genetics remain significant challenges.

To address these limitations, we developed \aladyn (Adaptive LAtent DYNamics with BernOULLI outcomes), a novel Bayesian framework designed to model time-varying disease risk signatures and personalized health trajectories from longitudinal EHR data. \aladyn introduces several key innovations: it identifies *dynamic latent risk signatures* that evolve continuously over time via Gaussian Processes (GPs); it directly models the prospective *probability of disease onset* using a survival likelihood framework, enabling prediction; its Bernoulli likelihood naturally handles complex multimorbidity by allowing non-competitive contributions from multiple signatures to multiple diseases; and it explicitly incorporates individual-level genetic and demographic factors ($\mathbf{g}_i$) to inform personalized signature affinity trajectories ($\lambda_{ik}$), while simultaneously learning population-level signature-disease associations ($\phi_{kd}$). By jointly modeling individuals, diseases, and time points, \aladyn borrows strength across data dimensions to uncover subtle patterns and robust signatures.

This paper introduces the \aladyn framework, details its implementation, and demonstrates its ability to uncover clinically meaningful, genetically validated disease signatures from large-scale EHR data. We show its capacity to capture diverse population and individual dynamics, and critically, we evaluate its superior performance in predicting near-term disease risk, highlighting its potential for dynamic clinical decision support. This approach is particularly relevant for understanding the interplay between genetic predisposition and age-dependent disease manifestation \cite{urbut_dynamic_2023, hyttinen_genetic_2003, pedersen_adult_2023}, offering insights crucial for fields like cardiovascular care where dynamic risk assessment is paramount \cite{urbut_aladyn_2024}.

\subsection*{Model Formulation}

\aladyn captures the complex interplay between latent disease signatures and their temporal evolution in individual patients (Fig.~\ref{fig:model_overview}A). The model represents the probability of disease occurrence $\pi_{i,d,t}$ for patient $i$, disease $d$, at time point $t$ as a mixture of contributions from $K$ latent signatures:

\begin{equation}
\pi_{i,d,t} = \kappa \cdot \sum_{k=1}^{K} \theta_{i,k,t} \cdot \text{sigmoid}(\phi_{k,d,t})
\end{equation}

\noindent where $\kappa$ is a global calibration parameter, $\theta_{i,k,t}$ represents patient $i$'s time-varying proportional affinity for signature $k$, and $\phi_{k,d,t}$ captures the log-odds contribution of signature $k$ to disease $d$ at time $t$.

The patient-signature affinities ($\theta_{i,k,t}$) are derived from latent variables $\lambda_{i,k,t}$ via a softmax transformation:
\begin{equation}
\theta_{i,k,t} = \frac{\exp(\lambda_{i,k,t})}{\sum_{k'} \exp(\lambda_{i,k',t})}
\end{equation}
\noindent This ensures $\theta_{i,k,t}$ represents a proper mixture distribution over signatures for each individual at each time point.

The patient-specific latent variables follow a Gaussian process (GP) prior, allowing smooth temporal evolution influenced by covariates:
\begin{equation}
\lambda_{i,k} \sim \mathcal{GP}(r_k + \mathbf{g}_i^{\top}\Gamma_k, K_{\lambda})
\label{eq:lambda_gp}
\end{equation}
\noindent where $r_k$ is a signature-specific baseline, $\mathbf{g}_i$ includes individual genetic and demographic factors, $\Gamma_k$ captures their influence on affinity for signature $k$, and $K_{\lambda}$ is a temporal covariance kernel (e.g., squared exponential with length scale $T/4$) ensuring smoothness.

Similarly, the signature-disease associations evolve over time via a GP:
\begin{equation}
\phi_{k,d} \sim \mathcal{GP}(\mu_d + \psi_{k,d}, K_{\phi})
\label{eq:phi_gp}
\end{equation}
\noindent where $\mu_d$ is a disease-specific baseline (related to prevalence), $\psi_{k,d}$ represents the overall time-invariant strength of association between signature $k$ and disease $d$, and $K_{\phi}$ is a temporal kernel (e.g., length scale $T/3$) allowing the signature's specific contribution to disease risk ($\phi_{k,d,t}$) to vary smoothly with age/time.

\subsection*{Survival Likelihood Framework}
Disease onset $Y_{idt}$ is modeled as a Bernoulli trial with probability $\pi_{idt}$. We employ a discrete-time survival likelihood. For an individual-disease pair $(i, d)$ with event/censoring time $E_{id}$ and event indicator $Y_{id,E_{id}}$ (1 if disease occurred, 0 if censored), the log-likelihood is:
\begin{equation}
\ell_{id} = \sum\limits_{t=1}^{E_{id}-1} \log(1 - \pi_{idt}) + Y_{id,E_{id}} \log(\pi_{id,E_{id}}) + (1 - Y_{id,E_{id}}) \log(1 - \pi_{id,E_{id}})
\label{eq:likelihood}
\end{equation}
\noindent The total data log-likelihood $\mathcal{L}_{\text{data}} = \sum_{id} \ell_{id}$. This formulation correctly accounts for time-to-event data in discrete intervals and naturally handles non-occurrence and co-occurrence of multiple diseases driven by the signature mixture, distinguishing it from retrospective allocation models.

\begin{figure}
\centering
\includegraphics[width=1.0\linewidth]{mod_ov2.pdf}
\caption{\textbf{ALADYNOULLI model structure and dynamics.} (A) Schematic representation showing how individual covariates ($\mathbf{g}_i$) influence latent temporal processes ($\lambda_{ik}$) determining signature affinities ($\theta_{ikt}$), which mix with signature-disease associations ($\phi_{kdt}$) to predict disease occurrence ($Y_{idt}$). Both $\lambda$ and $\phi$ follow Gaussian Processes. (B) Example distributions of signature affinities ($\theta$) across the population, revealing distinct patient subgroups. (C) Example temporal evolution of signature-disease associations ($\phi_{kdt}$), demonstrating age-dependent changes in risk profiles.}
\label{fig:model_overview}
\end{figure}

Table~\ref{tab:model_spec} summarizes the full mathematical specification of our model.

\begin{table}
\centering
\begin{tabular}{rcl}
\hline
$Y_{idt} | \pi_{idt}$ & $\sim$ & $\text{Bernoulli}(\pi_{idt})$ \\
$\pi_{idt} | \theta_{ikt}, \phi_{kdt}$ & $=$ & $\kappa \sum_k \theta_{ikt}\text{sigmoid}(\phi_{kdt})$ \\
$\theta_{ikt} | \lambda_{ikt}$ & $=$ & $\frac{\exp(\lambda_{ikt})}{\sum_{k'} \exp(\lambda_{ik't})}$ \\
$\lambda_{ik} | \mathbf{g}_i, \Gamma_k, K_{\lambda}$ & $\sim$ & $\mathcal{GP}(r_k + \mathbf{g}_i^{\top}\Gamma_k, K_{\lambda})$ \\
$\phi_{kd} | \mu_d, \psi_{kd}, K_{\phi}$ & $\sim$ & $\mathcal{GP}(\mu_d + \psi_{kd}, K_{\phi})$ \\
$K_{\lambda}(t, t')$ & $=$ & $\sigma^2_\lambda\exp(-\frac{(t-t')^2}{2l^2_\lambda})$ \\
$K_{\phi}(t, t')$ & $=$ & $\sigma^2_\phi\exp(-\frac{(t-t')^2}{2l^2_\phi})$ \\
$\Gamma_k$ & $\sim$ & $\mathcal{N}(0, \sigma^2_\gamma I_P)$ \\
\hline
\end{tabular}
\caption{\textbf{Mathematical specification of ALADYNOULLI.} $Y_{idt}$: disease indicator. $\pi_{idt}$: disease probability. $\theta_{ikt}$: individual signature affinity. $\phi_{kdt}$: signature-disease log-odds contribution. $\lambda_{ik}, \phi_{kd}$: latent variables following Gaussian Processes (GP) with covariates $\mathbf{g}_i$, coefficients $\Gamma_k$, baselines $r_k, \mu_d$, overall association $\psi_{kd}$, and kernels $K_{\lambda}, K_{\phi}$.}
\label{tab:model_spec}
\end{table}

\section{Results}

\subsection*{Discovery of Robust and Clinically Meaningful Disease Signatures}

Applied to data from UK Biobank, All of Us, and Mass General Brigham (N$\approx$500,000), \aladyn identified 21 distinct latent signatures representing coherent patterns of disease risk contributions. These signatures were highly interpretable, mapping well to known clinical domains ([Table \ref{tab:signature_diseases}, condensed in Tables \ref{tab:signature_diseases1}-\ref{tab:signature_diseases2}]). Key examples include Signature 5 (Coronary Artery Disease), Signature 6 (Metastatic Cancer), Signature 15 (Diabetes), Signature 0 (Cardiac Arrhythmias/Structure), and Signature 7 (Psychiatric/Fibromyalgia). The time-invariant associations ($\psi_{kd}$) confirmed strong, specific relationships between diseases and their primary signatures (typical ORs 2.5-3.5), while allowing plausible links to secondary signatures reflecting shared pathophysiology.

Crucially, these signatures demonstrated remarkable robustness across the three diverse cohorts. Disease co-occurrence patterns clustered consistently (mean pairwise consistency score = 0.84, [Methods]), supporting the biological validity of the signatures discovered by \aladyn ([Figure \ref{fig:signature_dynamics}D]). This suggests the model captures fundamental patterns of human disease independent of population-specific factors.

\begin{figure}[h] % Adjust placement as needed [hbtp]
\centering
    \singlespacing % Ensure singlespacing if needed for caption/figure separation
    \includegraphics[width=1\linewidth]{pop_sig2.pdf} % Placeholder for population/signature dynamics figure
    \caption{\textbf{Population-Level Signature Definitions and Temporal Patterns.} Illustrating dynamic patterns learned by \aladyn. (\textbf{A}) Example trajectories of top diseases associated with selected signatures, showing age-dependent activation probabilities. (\textbf{B}) Evolution of signature-disease associations ($\phi_{kdt}$) over time for specific examples. (\textbf{C}) Heatmap visualizing overall signature-disease associations ($\psi_{kd}$). (\textbf{D}) Scatter plot demonstrating cross-cohort consistency of disease groupings derived from co-occurrence patterns. (Adapt panel descriptions based on actual figure content).}
    \label{fig:signature_dynamics} % Use the specific label
\end{figure}

\subsection*{Signatures Exhibit Distinct Population and Individual Dynamics, Enabling Personalized Stratification}

The model captures both population-level age-dependent risk patterns, as shown by the temporal evolution of signature-disease associations ($\phi_{kdt}$, [Figure \ref{fig:signature_dynamics}A, B, C]), and personalized trajectories. These population dynamics sometimes varied across cohorts in ways consistent with known epidemiological trends (e.g., earlier onset of metabolic signature risk in more recent cohorts).

At the individual level, \aladyn models unique time-varying signature affinity profiles ($\lambda_{ikt}$ resulting in $\theta_{ikt}$), reflecting each person's evolving predisposition towards different disease processes ([Figure \ref{fig:individual_dynamics}] Panels A, B). This individualization is crucial. We observed significant heterogeneity in these trajectories, even among patients sharing the same primary diagnosis. For instance, analyzing patients based on their $\lambda_{ikt}$ dynamics allowed us to **stratify individuals** into distinct subgroups, potentially distinguishing disease subtypes (e.g., early vs. late onset MI) or different underlying etiologies ([Figure \ref{fig:individual_dynamics}] Panel D). Clustering patients based on their full signature trajectories further revealed subgroups with distinct multimorbidity profiles and progression patterns ([Figure \ref{fig:trajectory_clusters}]). This highlights the model's power to move beyond simple diagnostic labels and capture deeper patient-specific phenotypic variations.

Furthermore, \aladyn demonstrates a powerful ability to **adapt dynamically to new clinical information**. A censoring experiment starkly illustrated this: by masking myocardial infarction (MI) diagnoses several years prior to their occurrence, we observed that \aladyn often inferred a rising affinity for the cardiovascular signature (Sig 5). This inference was driven purely by the model **updating the patient's trajectory based on accumulating patterns in *other* correlated comorbid conditions** within that signature ([Figure \ref{fig:performance_barplot}] Panel C). This demonstrates the model's capacity to learn signatures reflecting evolving pathophysiology and continuously refine individual risk assessments as new data arrives, a critical feature for real-time clinical application.

\begin{figure}[h] % Adjust placement
    \centering
     \singlespacing
    \includegraphics[width=1\linewidth]{ind_stuff.pdf} % Placeholder for individual trajectory examples
    \caption{
\textbf{Individual-Level Risk and Signature Dynamics.} Examples illustrating how \aladyn captures personalized trajectories. (\textbf{A}) Evolution of signature affinities ($\theta_{ikt}$) for example patients, showing dynamic changes over time. (\textbf{B}) Corresponding latent Gaussian process paths ($\lambda_{ikt}$). (\textbf{C}) Decomposition of predicted risk for a specific disease (e.g., coronary atherosclerosis) into contributions from different signatures over time for an individual. (\textbf{D}) Heterogeneity in signature trajectories for patients with the same index diagnosis (e.g., early vs. late onset MI), highlighting personalized risk profiles.}
    \label{fig:individual_dynamics} % Changed label for clarity
\end{figure}

\begin{figure}[h] % Adjust placement
\singlespacing
    \includegraphics[width=1\linewidth]{trajectory.pdf} % Placeholder for heterogeneity/clustering figure
    \caption{\textbf{Heterogeneity in Patient Trajectories.} Illustrating stratification based on signature dynamics. (\textbf{A}) Dynamics of signature loadings across different patient clusters identified by trajectory patterns. (\textbf{B}) Heatmaps showing signature feature loadings, emphasizing differences across clusters. (\textbf{C}) Analysis of signature trajectories stratified by clinical factors (e.g., early vs. late onset disease), revealing distinct temporal patterns.}
\label{fig:trajectory_clusters} % Use a specific label
\end{figure}

\subsection*{Genetic Validation of Disease Signatures}

To assess the biological grounding of the data-driven signatures, we correlated individual signature affinities (e.g., integrated exposure over time) with genetic data. Using LD Score Regression against external GWAS summary statistics, signatures showed highly significant and specific genetic correlations with relevant complex traits ([Figure \ref{fig:genetics}A]). For example, Sig 5 correlated strongly with coronary artery disease GWAS, Sig 15 with Type 2 Diabetes, and Sig 7 with Major Depressive Disorder. GWAS of the signatures themselves revealed distinct genetic architectures ([Figure \ref{fig:genetics}B]). Polygenic risk scores (PRS) also associated significantly with corresponding signature affinities ([Figure \ref{fig:genetics}C]). These convergent lines of genetic evidence strongly support that \aladyn signatures capture biologically meaningful, genetically-influenced pathways.

\subsection*{\aladyn Provides Accurate Short- and Long-Term Risk Forecasts}

A key application of dynamic health models is forecasting clinical events. We evaluated \aladyn's ability to predict the onset of major diseases over both short-term (1-year) and long-term (10-year) horizons following enrollment, using only prior history. We compared its performance (Area Under the ROC Curve, AUROC) against a strong Cox proportional hazards baseline incorporating age, sex, and family history.

\aladyn demonstrated strong predictive accuracy across both time horizons, consistently performing well and often outperforming the Cox baseline ([Figure \ref{fig:performance_barplot}], Top panel for 10-year, Bottom panel for 1-year). The model's advantage was particularly pronounced for **1-year predictions**. Here, leveraging the *dynamics* of an individual's recent health trajectory, captured by evolving signature affinities, provides substantial gains over static baseline factors. For this near-term horizon, notable AUROC improvements (>0.10 point estimate difference compared to Cox) were observed for conditions including ASCVD, All Cancers, Anemia, Asthma, Atrial Fibrillation, COPD, Colorectal Cancer, Depression, Diabetes, Osteoporosis, Prostate Cancer, Thyroid Disorders, and Breast Cancer. For **10-year predictions**, \aladyn also generally showed strong performance and outperformed the Cox baseline for most diseases, demonstrating robustness for longer-term forecasting even when static factors play a larger role. The model's 1-year predictions were also well-calibrated ([Figure \ref{fig:performance_barplot}, referring to the calibration plot, assuming it's Panel A]). This capacity for accurate risk assessment across time horizons, with particular strength in dynamically updated near-term forecasts, underscores its clinical utility.

\begin{figure}
\centering
\singlespacing
\includegraphics[width=1\linewidth]{genetics.pdf}
    \caption{\textbf{Genetic Validation of \aladyn Signatures.} (\textbf{A}) Heatmap showing genetic correlations (LDSC) between signatures and relevant external GWAS traits. (\textbf{B}) Associations between signature affinities and polygenic risk scores (PRS). (\textbf{C}) Example Manhattan plots from GWAS of signature affinities, revealing distinct genetic architectures.}
    \label{fig:genetics}
\end{figure}

\begin{figure}
    \centering
    \singlespacing
    \includegraphics[width=1\linewidth]{performance.pdf}
    \caption{\textbf{Predictive Performance and Dynamic Risk Updates.} (\textbf{A}) Calibration plot for \aladyn's 1-year risk predictions showing good agreement between predicted and observed probabilities. (\textbf{B}) Comparison of 1-year prediction performance (AUROC) between \aladyn and a Cox baseline across multiple diseases, demonstrating \aladyn's advantage. (\textbf{C}) Example latent trajectories ($\lambda_{ikt}$) for the cardiovascular signature (Sig 5) for patients who later developed MI, showing increasing activation prior to the (censored) event time (red lines indicate censoring, blue lines actual diagnosis if uncensored).}
    \label{fig:performance_barplot}
\end{figure}

\section{Discussion}

\aladyn provides a novel framework for modeling the complex interplay between multiple diseases over time, identifying interpretable, dynamic risk signatures that capture distinct patterns of comorbidity and progression. Our results across large, diverse cohorts demonstrate the model's ability to discover robust, clinically meaningful, and genetically validated signatures.

A key distinction from prior work, particularly allocation-based topic models, is \aladyn's prospective, probabilistic formulation focused on predicting disease *risk* using a non-competitive Bernoulli survival likelihood. This allows for direct risk estimation, natural handling of multimorbidity, and modeling of disease non-occurrence. The use of Gaussian processes enables the capture of smooth, continuous temporal dynamics for both population-level signature-disease relationships ($\phi_{kdt}$) and **highly personalized signature affinities ($\lambda_{ikt}$), which form the basis for individual-level insights.**

The identified signatures align with known clinical entities while revealing nuanced disease relationships. The strong genetic correlations provide biological validation, suggesting the signatures represent underlying pathophysiological processes. Analyzing individual trajectories ($\lambda_{ikt}$) revealed considerable heterogeneity. This ability to characterize individual dynamic profiles is a core strength, offering potential insights into disease subtypes, differential progression rates, and personalized risk evolution. Crucially, these learned trajectories provide a powerful mechanism for **patient stratification**, grouping individuals based on their underlying dynamic health state rather than just static diagnoses.

Critically, the temporal dynamics captured by \aladyn translate into superior predictive performance across both short- and long-term horizons, with a particularly striking advantage for **short-term (1-year) risk**. This ability stems directly from the model's capacity to integrate a patient's entire history and, importantly, **dynamically adapt to their recent trajectory**. Unlike static risk scores calculated once, \aladyn enables risk assessment that **evolves in response to new clinical data**, providing continuously updated, personalized profiles. The censoring experiment further underscores this adaptive capability, showing the model can infer rising risk from evolving comorbid patterns even before a target event occurs. This dynamic adaptation and the resulting potential for timely intervention represent a key advantage for clinical applications.

The identification of common signature transitions and the stratification based on trajectory patterns provide a potential framework for understanding multimorbidity development pathways and identifying critical windows for preemptive intervention.

Limitations include reliance on EHR data quality, the specific assumptions of the GP mixture model, and the lack of explicit treatment modeling. Future work should address incorporating treatments, exploring more complex temporal models, and prospective clinical validation focusing on how the dynamic updates and stratification impact care.

Despite these limitations, \aladyn represents a significant advance in longitudinal health data analysis. Its ability to identify interpretable dynamic risk signatures, **adaptively model personalized trajectories**, **stratify patients based on dynamic phenotypes**, and predict near-term disease events with high accuracy holds important implications for understanding disease mechanisms, improving clinical decision-making, and advancing personalized medicine.

\section{Materials and Methods}

\subsection*{Data Source and Preprocessing}
We used data from UK Biobank, All of Us, and Mass General Brigham... [Details on cohorts, ICD mapping to PheCodes, time discretization, inclusion criteria, covariate processing - keep concise].

\subsection*{Generative Model Formulation}

\aladyn{} employs a novel generative model that fundamentally differs from traditional allocation-based approaches such as Latent Dirichlet Allocation (LDA) or Age-dependent Topic Models (ATM). Here, we provide a detailed description of the generative process and highlight key distinctions.

\begin{figure}[h] % Keep figure within Methods if desired, adjust placement [hbtp] as needed
    \centering
    \includegraphics[width=0.5\linewidth]{model-comparison-diagram.pdf} % Ensure this file exists and path is correct
    \caption{\textbf{Conceptual Comparison of \aladyn and Allocation Models.} Allocation models (like LDA/ATM, left) assign occurred disease events to latent topics. \aladyn (right) models the prospective probability of disease occurrence as a mixture derived from continuous latent processes (signatures).}
    \label{fig:model_comparison} % Give it a unique label
\end{figure}

\subsubsection*{Disease Risk Mixture Model}
In \aladyn{}, we model the probability of disease occurrence $\pi_{idt}$ for individual $i$, disease $d$, at time $t$ as defined in Equation \ref{eq:risk_mixture}:
\begin{equation*} % Use equation* if no number needed here as it's defined above
\pi_{idt} = \kappa \cdot \sum_{k=1}^{K} \theta_{ikt} \cdot \text{sigmoid}(\phi_{kdt})
\end{equation*}
Where $\kappa$ is a global calibration parameter, $\theta_{ikt}$ represents individual $i$'s time-varying association with signature $k$ at time $t$, and $\phi_{kdt}$ captures the log-odds contribution of signature $k$ to disease $d$ at time $t$.

This formulation is fundamentally different from allocation-based approaches like ATM in several key ways (Fig.~\ref{fig:model_comparison}):
\begin{enumerate}
    \item \textbf{Predictive vs. Conditional Framework:} ATM and similar allocation models are retrospective—they model the probability that a disease belongs to a specific topic given that the disease has already occurred. In contrast, \aladyn{} is prospective—it models the probability of disease occurrence, making it directly applicable for risk prediction.
    \item \textbf{Non-competitive Disease Structure:} Unlike ATM where diseases compete for topic assignment (each disease event must be assigned to exactly one topic), \aladyn{} allows multiple signatures to contribute to the risk of a single disease, reflecting the reality that diseases often arise from multiple underlying biological processes.
    \item \textbf{Continuous-time Dynamics:} While ATM often discretizes age into bins, \aladyn{} models truly continuous temporal evolution through Gaussian processes, capturing potentially smoother trajectories of disease risk.
\end{enumerate}

\subsubsection*{Individual Signature Associations}
The individual-signature associations $\theta_{ikt}$ are derived from latent variables $\lambda_{ikt}$ through a softmax transformation, ensuring $\sum_k \theta_{ikt} = 1$. These latent variables follow a Gaussian process prior with a mean function informed by genetic and demographic factors $\mathbf{g}_i$ and a temporal covariance kernel $K_\lambda$, as shown in Equation \ref{eq:lambda_gp}:
\begin{equation*} % Use equation* if no number needed here
\lambda_{ik} \sim \mathcal{GP}(r_k + \mathbf{g}_i^{\top}\Gamma_k, K_{\lambda})
\end{equation*}
This allows individual affinities for signatures to evolve smoothly over time, anchored by their baseline covariates but adapting based on observed data.

\subsubsection*{Disease-Signature Relationships}
The signature-disease relationships are modeled through latent variables $\phi_{kdt}$ that also follow a Gaussian process (Equation \ref{eq:phi_gp}):
\begin{equation*} % Use equation* if no number needed here
\phi_{kd} \sim \mathcal{GP}(\mu_d + \psi_{kd}, K_{\phi})
\end{equation*}
This allows the specific contribution of signature $k$ to the risk of disease $d$ to vary smoothly over age/time, centered around a disease-specific baseline $\mu_d$ and an overall signature-disease association strength $\psi_{kd}$. The sigmoid function transforms the log-odds contribution $\phi_{kdt}$ into a probability component.

\subsubsection*{Comparison with Allocation-Based Approaches (Reiteration)}
To further clarify the distinction:
\begin{itemize}
    \item \textbf{ATM and LDA:} Model $P(z_{id} = k | Y_{id} = 1, t)$, the probability that disease occurrence $d$ for individual $i$ at time $t$ is assigned to topic $k$, *conditional on the disease having occurred*.
    \item \textbf{\aladyn{}:} Models $P(Y_{idt} = 1)$, the *unconditional probability* that disease $d$ occurs for individual $i$ at time $t$, as a mixture of signature-specific probabilities.
\end{itemize}
This distinction means \aladyn{} provides direct risk estimates, models non-occurrence, allows multiple signatures to influence a disease, and makes no assumptions about competition between diseases for topic assignment.

\subsubsection*{Survival Likelihood Framework (Reiteration)}
The discrete-time survival likelihood (Equation \ref{eq:likelihood}) is crucial for handling the longitudinal, time-to-event nature of EHR data. It correctly incorporates information from periods where individuals are disease-free and at risk, up until the point of diagnosis or censoring.

\subsubsection*{Implications for Disease Signatures}
This formulation allows for the discovery of disease signatures representing distinct biological processes rather than mere co-occurrence clusters. The $\psi_{kd}$ parameters capture core signature-disease strengths, while the dynamic $\phi_{kdt}$ allows age-dependent manifestations. Unlike allocation models, \aladyn allows diseases to be strongly associated with multiple signatures (reflecting pleiotropy or shared pathways) and focuses on predicting future risk rather than allocating past events.

\subsection*{Model Implementation}
Model implemented in PyTorch, trained using Adam (learning rate 0.001, batch size 1000). Initialized $\psi_{kd}$ using spectral clustering. $K=21$ signatures chosen based on preliminary analyses... [Details on GP amplitude fixing, kappa, learning rates]. Trained up to 1000 epochs with early stopping.

\subsection*{Evaluation Metrics}
Primary evaluation used prospective 1-year prediction on a held-out test set. Performance measured by AUROC (95% CIs via DeLong method). Calibration assessed using reliability diagrams.

\subsection*{Baseline Models}
Compared against a Cox proportional hazards model using age, sex, and family history at enrollment as predictors, trained per disease on the same data.

\subsection*{Cross-Cohort Signature Consistency}
Disease blocks were identified using hierarchical clustering on pairwise disease co-occurrence matrices within each biobank. Consistency was measured using a pairwise score comparing block membership across cohorts... [Add specific metric details].

\subsection*{Genetic Analysis}
Integrated signature exposure calculated as AUC for $\theta_{ikt}$. GWAS performed on these exposures. LDSC used to estimate genetic correlation with external traits... [Details on software/references]. PRS calculated using standard methods... [Details].

\section*{References and Notes}

\begin{enumerate}
\item \label{example1} A. Author et al., "Electronic health records for clinical research: Review of applications, challenges, and opportunities," Journal of Medical Informatics 45, 123-456 (2020). % Placeholder
\item \label{example2} B. Researcher, C. Scientist, "Challenges in analyzing longitudinal health data," Biostatistics 30, 789-012 (2019). % Placeholder
\item \label{example3} D. Analyst et al., "Pairwise disease associations: limitations and opportunities," Nature Methods 15, 345-678 (2018). % Placeholder
\item \label{example4} E. Modeler, F. Statistician, "Unsupervised learning for disease trajectory analysis," Machine Learning for Healthcare 5, 901-234 (2021). % Placeholder
\item \label{jiang_age-dependent_2023} Jiang et al., "Age-dependent topic modeling..." (2023). % Placeholder - Add full citation
\item \label{urbut_dynamic_2023} Urbut et al., "Dynamic..." (2023). % Placeholder - Add full citation
\item \label{hyttinen_genetic_2003} Hyttinen et al., "Genetic liability..." (2003). % Placeholder - Add full citation
\item \label{pedersen_adult_2023} Pedersen et al., "Adult..." (2023). % Placeholder - Add full citation
\item \label{urbut_aladyn_2024} Urbut et al., "Aladyn..." (2024). % Placeholder - Add full citation
\item \label{methods} See Supplementary Materials for detailed methods. % Keep this if M&M is in supplement
\end{enumerate}

\clearpage % Clear all remaining figures and tables then start a new page

\bibliography{exportforoverleaf} % for a file named science_template.bib
\bibliographystyle{sciencemag} % Use appropriate style

\end{document}