}
}
matplot(t(all_thetas[101,,]))
pop_mean=apply(all_thetas,c(2,3),mean)
matplot(t(pop_mean))
image(t(phi_prob[,113,]))
contributions=as.matrix(all_thetas[101,,])*(as.matrix(phi_prob[,113,]))*as.numeric(ukb_params$kappa)
matplot(t(contributions))
library(ggplot2)
library(reshape2)
library(patchwork)   # For combining plots
# 1. Individual signature trajectory
theta_indiv <- as.data.frame(t(all_thetas[101, , ]))
colnames(theta_indiv) <- paste0("Sig", 1:ncol(theta_indiv))
theta_indiv$Time <- 1:nrow(theta_indiv)
theta_indiv_long <- melt(theta_indiv, id.vars = "Time", variable.name = "Signature", value.name = "Theta")
# 2. Population mean signature trajectory
pop_mean <- apply(all_thetas, c(2,3), mean)
pop_mean_df <- as.data.frame(t(pop_mean))
colnames(pop_mean_df) <- paste0("Sig", 1:ncol(pop_mean_df))
pop_mean_df$Time <- 1:nrow(pop_mean_df)
pop_mean_long <- melt(pop_mean_df, id.vars = "Time", variable.name = "Signature", value.name = "Theta")
# 3. Signature contributions for individual and disease
phi_vec <- phi_prob[, 113, ]  # K x T
contributions <- t(all_thetas[101, , ]) * t(phi_vec) * as.numeric(ukb_params$kappa)  # T x K
contrib_df <- as.data.frame(contributions)
colnames(contrib_df) <- paste0("Sig", 1:ncol(contrib_df))
contrib_df$Time <- 1:nrow(contrib_df)
contrib_long <- melt(contrib_df, id.vars = "Time", variable.name = "Signature", value.name = "Contribution")
library(ggplot2)
library(reshape2)
library(patchwork)
# Assume all_thetas, phi_prob, ukb_params$kappa, and brewerPlus are loaded
# Individual and population theta (K x T)
theta_indiv <- t(all_thetas[101, , ])
pop_mean <- t(apply(all_thetas, c(2,3), mean))
sig_names <- c(0:20)
colnames(theta_indiv) <- sig_names
colnames(pop_mean) <- sig_names
theta_df <- rbind(
data.frame(Time = 1:nrow(theta_indiv), as.data.frame(theta_indiv), Type = "Individual"),
data.frame(Time = 1:nrow(pop_mean), as.data.frame(pop_mean), Type = "Population")
)
theta_long <- melt(theta_df, id.vars = c("Time", "Type"), variable.name = "Signature", value.name = "Theta")
theta_long$Signature <- factor(theta_long$Signature, levels = sig_names)
# Combine for plotting
theta_df <- rbind(
data.frame(Time = 1:nrow(theta_indiv), as.data.frame(theta_indiv), Type = "Individual"),
data.frame(Time = 1:nrow(pop_mean), as.data.frame(pop_mean), Type = "Population")
)
theta_long <- melt(theta_df, id.vars = c("Time", "Type"), variable.name = "Signature", value.name = "Theta")
# Stacked area plot needs to be sorted by signature
theta_long$Signature <- factor(theta_long$Signature, levels = paste0("V", 1:dim(theta_indiv)[2]))
phi_df <- as.data.frame(phi_prob[, 113, ])
colnames(phi_df) <- paste0("Age", 1:ncol(phi_df))
phi_df$Signature <- factor(sig_names)
phi_long <- melt(phi_df, id.vars = "Signature", variable.name = "Age", value.name = "LogOdds")
colnames(contributions) <- sig_names
contrib_df <- data.frame(Time = 1:nrow(contributions), as.data.frame(contributions))
contrib_long <- melt(contrib_df, id.vars = "Time", variable.name = "Signature", value.name = "Contribution")
contrib_long$Signature <- factor(contrib_long$Signature, levels = sig_names)# 3. Stacked area plot of contributions
contributions <- t(all_thetas[101, , ]) * t(phi_prob[, 113, ]) * as.numeric(ukb_params$kappa)
contrib_df <- data.frame(Time = 1:nrow(contributions), as.data.frame(contributions))
contrib_long <- melt(contrib_df, id.vars = "Time", variable.name = "Signature", value.name = "Contribution")
contrib_long$Signature <- factor(contrib_long$Signature, levels = paste0("V", 1:dim(contributions)[2]))
# Use your custom palette
n_sigs <- length(unique(theta_long$Signature))
my_colors <- brewerPlus[1:21]
# Top: Stacked area plot for theta
p1 <- ggplot(theta_long, aes(x = Time, y = Theta,linetype =Type, col = Signature)) +
geom_smooth() +
#facet_wrap(~Type, ncol = 1) +
scale_fill_manual(values = my_colors) +
theme_classic() +
labs(title = "Signature Proportions Over Time", y = "Theta", x = "Time")
# Middle: Heatmap of phi_prob
p2 <- ggplot(phi_long, aes(x = Age, y = Signature, fill = LogOdds)) +
geom_tile() +
scale_fill_gradient2(low = "blue", mid = "white", high = "red", midpoint = 0) +
theme_classic() +
labs(title = "Temporal Signature Associations for Disease", y = "Signature", x = "Age")
# Bottom: Stacked area plot for contributions
p3 <- ggplot(contrib_long, aes(x = Time, y = Contribution, fill = Signature)) +
geom_area(position = "stack", alpha = 0.7) +
scale_fill_manual(values = my_colors) +
theme_classic() +
labs(title = "Signature Contributions to Risk", y = "Risk", x = "Time")
final_plot <- p1 / p2 / p3 + plot_layout(heights = c(1, 0.7, 1), guides = "collect") & theme(legend.position = "bottom")
print(final_plot)
head(theta_long)
colnames(theta_indiv) <- sig_names
colnames(pop_mean) <- sig_names
theta_df <- rbind(
data.frame(Time = 1:nrow(theta_indiv), as.data.frame(theta_indiv), Type = "Individual"),
data.frame(Time = 1:nrow(pop_mean), as.data.frame(pop_mean), Type = "Population")
)
theta_long <- melt(theta_df, id.vars = c("Time", "Type"), variable.name = "Signature", value.name = "Theta")
theta_long$Signature <- factor(theta_long$Signature, levels = sig_names)
# Combine for plotting
theta_df <- rbind(
data.frame(Time = 1:nrow(theta_indiv), as.data.frame(theta_indiv), Type = "Individual"),
data.frame(Time = 1:nrow(pop_mean), as.data.frame(pop_mean), Type = "Population")
)
head(theta_df)
head(theta_long)
theta_long <- melt(theta_df, id.vars = c("Time", "Type"), variable.name = "Signature", value.name = "Theta")
head(theta_df)
head(theta_long)
theta_long$Signature <- factor(theta_long$Signature, levels = 0:20)
head(theta_long)
theta_long$Signature <- factor(theta_long$Signature, levels = c(0:20))
head(theta_long)
# Stacked area plot needs to be sorted by signature
theta_long$Signature <- factor(theta_long$Signature, levels = as.character(c(0:20)))
head(theta_long)
head(theta_long)
theta_long$Signature <- factor(theta_long$Signature, levels = paste0("V", 1:dim(theta_indiv)[2]))
head(theta_long)
sig_names
sig_names <- c(0:20)
colnames(theta_indiv) <- sig_names
colnames(pop_mean) <- sig_names
theta_df <- rbind(
data.frame(Time = 1:nrow(theta_indiv), as.data.frame(theta_indiv), Type = "Individual"),
data.frame(Time = 1:nrow(pop_mean), as.data.frame(pop_mean), Type = "Population")
)
theta_long <- melt(theta_df, id.vars = c("Time", "Type"), variable.name = "Signature", value.name = "Theta")
theta_long$Signature <- factor(theta_long$Signature, levels = sig_names)
head(theta_long)
theta_long$Signature
factor(theta_long$Signature)
phi_df <- as.data.frame(phi_prob[, 113, ])
colnames(phi_df) <- 30:81
phi_df$Signature <- factor(sig_names)
phi_long <- melt(phi_df, id.vars = "Signature", variable.name = "Age", value.name = "LogOdds")
colnames(contributions) <- sig_names
contrib_df <- data.frame(Time = 1:nrow(contributions), as.data.frame(contributions))
contrib_long <- melt(contrib_df, id.vars = "Time", variable.name = "Signature", value.name = "Contribution")
contrib_long$Signature <- factor(contrib_long$Signature, levels = sig_names)# 3. Stacked area plot of contributions
contributions <- t(all_thetas[101, , ]) * t(phi_prob[, 113, ]) * as.numeric(ukb_params$kappa)
contrib_df <- data.frame(Time = 1:nrow(contributions), as.data.frame(contributions))
contrib_long <- melt(contrib_df, id.vars = "Time", variable.name = "Signature", value.name = "Contribution")
contrib_long$Signature <- factor(contrib_long$Signature, levels = paste0("V", 1:dim(contributions)[2]))
# Use your custom palette
n_sigs <- length(unique(theta_long$Signature))
my_colors <- brewerPlus[1:21]
# Top: Stacked area plot for theta
p1 <- ggplot(theta_long, aes(x = Time, y = Theta,linetype =Type, col = Signature)) +
geom_smooth() +
#facet_wrap(~Type, ncol = 1) +
scale_fill_manual(values = my_colors) +
theme_classic() +
labs(title = "Signature Proportions Over Time", y = "Theta", x = "Time")
p2 <- ggplot(phi_long, aes(x = Age, y = Signature, fill = LogOdds)) +
geom_tile() +
scale_fill_gradient2(low = "blue", mid = "white", high = "red", midpoint = 0) +
theme_classic() +
labs(title = "Temporal Signature Associations for Disease", y = "Signature", x = "Age")
p2
theta_df <- rbind(
data.frame(Time = 1:nrow(theta_indiv), as.data.frame(theta_indiv), Type = "Individual"),
data.frame(Time = 1:nrow(pop_mean), as.data.frame(pop_mean), Type = "Population")
)
theta_long <- melt(theta_df, id.vars = c("Time", "Type"), variable.name = "Signature", value.name = "Theta")
theta_long$Signature <- factor(sig_names)
head(theta_long)
colnames(contributions) <- sig_names
contrib_df <- data.frame(Time = 1:nrow(contributions), as.data.frame(contributions))
contrib_long <- melt(contrib_df, id.vars = "Time", variable.name = "Signature", value.name = "Contribution")
contrib_long$Signature <- factor(contrib_long$Signature, levels = sig_names)# 3. Stacked area plot of contributions
contrib_long
contrib_long$Signature <- factor(sig_names)# 3. Stacked area plot of contributions
dim(contributions)
colnames(contributions) <- sig_names
rownames(contributions) = 30:81
contrib_df <- data.frame(Time = 1:nrow(contributions), as.data.frame(contributions))
contrib_long <- melt(contrib_df, id.vars = "Time", variable.name = "Signature", value.name = "Contribution")
contrib_long$Signature <- factor(sig_names)# 3. Stacked area plot of contributions
# Use your custom palette
n_sigs <- length(unique(theta_long$Signature))
my_colors <- brewerPlus[1:21]
# Top: Stacked area plot for theta
p1 <- ggplot(theta_long, aes(x = Time, y = Theta,linetype =Type, col = Signature)) +
geom_smooth() +
#facet_wrap(~Type, ncol = 1) +
scale_fill_manual(values = my_colors) +
theme_classic() +
labs(title = "Signature Proportions Over Time", y = "Theta", x = "Time")
# Middle: Heatmap of phi_prob
p2 <- ggplot(phi_long, aes(x = Age, y = Signature, fill = LogOdds)) +
geom_tile() +
scale_fill_gradient2(low = "blue", mid = "white", high = "red", midpoint = 0) +
theme_classic() +
labs(title = "Temporal Signature Associations for Disease", y = "Signature", x = "Age")
# Bottom: Stacked area plot for contributions
p3 <- ggplot(contrib_long, aes(x = Time, y = Contribution, fill = Signature)) +
geom_area(position = "stack", alpha = 0.7) +
scale_fill_manual(values = my_colors) +
theme_classic() +
labs(title = "Signature Contributions to Risk", y = "Risk", x = "Time")
final_plot <- p1 / p2 / p3 + plot_layout(heights = c(1, 0.7, 1), guides = "collect") & theme(legend.position = "bottom")
print(final_plot)
theta_df <- rbind(
data.frame(Time = 1:nrow(theta_indiv), as.data.frame(theta_indiv), Type = "Individual"),
data.frame(Time = 1:nrow(pop_mean), as.data.frame(pop_mean), Type = "Population")
)
head(theta_indic)
head(theta_indiv)
dim(theta_indiv)
theta_df <- rbind(
data.frame(Time = 30:81, as.data.frame(theta_indiv), Type = "Individual"),
data.frame(Time = 30:81, as.data.frame(pop_mean), Type = "Population")
)
theta_long <- melt(theta_df, id.vars = c("Time", "Type"), variable.name = "Signature", value.name = "Theta")
theta_long$Signature <- factor(sig_names)
str(theta_long)
p1 <- ggplot(theta_long, aes(x = Time, y = Theta,linetype =Type, col = Signature)) +
geom_smooth() +
#facet_wrap(~Type, ncol = 1) +
scale_fill_manual(values = my_colors) +
theme_classic() +
labs(title = "Signature Proportions Over Time", y = "Theta", x = "Time")
p1
# Individual and population theta (K x T)
theta_indiv <- t(all_thetas[101, , ])
pop_mean <- t(apply(all_thetas, c(2,3), mean))
sig_names <- c(0:20)
colnames(theta_indiv) <- sig_names
colnames(pop_mean) <- sig_names
theta_df <- rbind(
data.frame(Time = 30:81, theta_indiv, Type = "Individual"),
data.frame(Time = 30:81, pop_mean, Type = "Population")
)
theta_long <- melt(theta_df, id.vars = c("Time", "Type"), variable.name = "Signature", value.name = "Theta")
str(theta_long)
# Top: Stacked area plot for theta
p1 <- ggplot(theta_long, aes(x = Time, y = Theta,linetype =Type, col = Signature)) +
geom_smooth() +
#facet_wrap(~Type, ncol = 1) +
scale_fill_manual(values = my_colors) +
theme_classic() +
labs(title = "Signature Proportions Over Time", y = "Theta", x = "Time")
p1
theta_long <- melt(theta_df, id.vars = c("Time", "Type"), variable.name = "Signature", value.name = "Theta")
theta_long$Signature <- factor(as.character(theta_long$Signature),levels = sig_names)
# Combine for plotting
# Top: Stacked area plot for theta
p1 <- ggplot(theta_long, aes(x = Time, y = Theta,linetype =Type, col = Signature)) +
geom_smooth() +
#facet_wrap(~Type, ncol = 1) +
scale_fill_manual(values = my_colors) +
theme_classic() +
labs(title = "Signature Proportions Over Time", y = "Theta", x = "Time")
p1
theta_long <- melt(theta_df, id.vars = c("Time", "Type"), variable.name = "Signature", value.name = "Theta")
# Combine for plotting
phi_df <- as.data.frame(phi_prob[, 113, ])
colnames(phi_df) <- 30:81
phi_long <- melt(phi_df, id.vars = "Signature", variable.name = "Age", value.name = "LogOdds")
p2
head(contrib_long)
colnames(contributions) <- sig_names
rownames(contributions) = 30:81
contrib_df <- data.frame(Time = 1:nrow(contributions), as.data.frame(contributions))
contrib_long <- melt(contrib_df, id.vars = "Time", variable.name = "Signature", value.name = "Contribution")
head(contrib_long)
# Bottom: Stacked area plot for contributions
p3 <- ggplot(contrib_long, aes(x = Time, y = Contribution, fill = Signature)) +
geom_area(position = "stack", alpha = 0.7) +
scale_fill_manual(values = my_colors) +
theme_classic() +
labs(title = "Signature Contributions to Risk", y = "Risk", x = "Time")
p3
final_plot <- p1 / p2 / p3, guides = "collect") & theme(legend.position = "bottom")
final_plot <- p1 / p2 / p3 , guides = "collect") & theme(legend.position = "bottom")
final_plot <- p1 / p2 / p3, guides = "collect") & theme(legend.position = "bottom")
final_plot <- p1 / p2 / p3 + plot_layout(heights = c(1, 1,1), guides = "collect") & theme(legend.position = "bottom")
print(final_plot)
library(ggplot2)
library(reshape2)
library(patchwork)
# Assume all_thetas, phi_prob, ukb_params$kappa, and brewerPlus are loaded
# Individual and population theta (K x T)
theta_indiv <- t(all_thetas[101, , ])
pop_mean <- t(apply(all_thetas, c(2,3), mean))
sig_names <- c(0:20)
colnames(theta_indiv) <- sig_names
colnames(pop_mean) <- sig_names
theta_df <- rbind(
data.frame(Time = 30:81, theta_indiv, Type = "Individual"),
data.frame(Time = 30:81, pop_mean, Type = "Population")
)
theta_long <- melt(theta_df, id.vars = c("Time", "Type"), variable.name = "Signature", value.name = "Theta")
# Combine for plotting
phi_df <- as.data.frame(phi_prob[, 113, ])
colnames(phi_df) <- 30:81
phi_long <- melt(phi_df, id.vars = "Signature", variable.name = "Age", value.name = "LogOdds")
phi_df <- as.data.frame(phi_prob[, 113, ])
colnames(phi_df) <- 30:81
phi_long <- melt(phi_df, id.vars = "Signature", variable.name = "Age", value.name = "LogOdds")
head(phi_df)
head(phi_lon)
p2 <- ggplot(phi_long, aes(x = Age, y = Signature, fill = LogOdds)) +
geom_tile() +
scale_fill_gradient2(low = "blue", mid = "white", high = "red", midpoint = 0) +
theme_classic() +
labs(title = "Temporal Signature Associations for Disease", y = "Signature", x = "Age")
p2
phi_long <- melt(phi_df, id.vars = "Signature", variable.name = "Age", value.name = "LogOdds")
head(phi_df)
dim(phi_df)
phi_df <- as.data.frame(phi_prob[, 113, ])
colnames(phi_df) <- 30:81
phi_df$Signature=c(0:20)
phi_long <- melt(phi_df, id.vars = "Signature", variable.name = "Age", value.name = "LogOdds")
colnames(contributions) <- sig_names
rownames(contributions) = 30:81
contrib_df <- data.frame(Time = 1:nrow(contributions), as.data.frame(contributions))
contrib_long <- melt(contrib_df, id.vars = "Time", variable.name = "Signature", value.name = "Contribution")
# Use your custom palette
n_sigs <- length(unique(theta_long$Signature))
my_colors <- brewerPlus[1:21]
# Top: Stacked area plot for theta
p1 <- ggplot(theta_long, aes(x = Time, y = Theta,linetype =Type, col = Signature)) +
geom_smooth() +
#facet_wrap(~Type, ncol = 1) +
scale_fill_manual(values = my_colors) +
theme_classic() +
labs(title = "Signature Proportions Over Time", y = "Theta", x = "Time")
# Middle: Heatmap of phi_prob
p2 <- ggplot(phi_long, aes(x = Age, y = Signature, fill = LogOdds)) +
geom_tile() +
scale_fill_gradient2(low = "blue", mid = "white", high = "red", midpoint = 0) +
theme_classic() +
labs(title = "Temporal Signature Associations for Disease", y = "Signature", x = "Age")
p2
head(theta_long)
dim(theta_df)
head(theta_df)
sig_names <- c(0:20)
colnames(theta_indiv) <- sig_names
colnames(pop_mean) <- sig_names
head(theta_indic)
head(theta_indiv)
theta_df <- rbind(
data.frame(Time = 30:81, theta_indiv, Type = "Individual"),
data.frame(Time = 30:81, pop_mean, Type = "Population")
)
theta_long <- melt(theta_df, id.vars = c("Time", "Type"), variable.name = "Signature", value.name = "Theta")
# Combine for plotting
theta_df
colnames(theta_df)[,c(2:22)]=c(0:20)
colnames(theta_df)[c(2:22)]=c(0:20)
theta_long <- melt(theta_df, id.vars = c("Time", "Type"), variable.name = "Signature", value.name = "Theta")
# Combine for plotting
p1 <- ggplot(theta_long, aes(x = Time, y = Theta,linetype =Type, col = Signature)) +
geom_smooth() +
#facet_wrap(~Type, ncol = 1) +
scale_fill_manual(values = my_colors) +
theme_classic() +
labs(title = "Signature Proportions Over Time", y = "Theta", x = "Time")
pq
p1
colnames(contributions) <- sig_names
rownames(contributions) = 30:81
contrib_df <- data.frame(Time = 1:nrow(contributions), data.frame(contributions))
colnames(contrib_df)[2:22]=sig_names
contrib_long <- melt(contrib_df, id.vars = "Time", variable.name = "Signature", value.name = "Contribution")
# Use your custom palette
n_sigs <- length(unique(theta_long$Signature))
my_colors <- brewerPlus[1:21]
# Top: Stacked area plot for theta
p1 <- ggplot(theta_long, aes(x = Time, y = Theta,linetype =Type, col = Signature)) +
geom_smooth() +
#facet_wrap(~Type, ncol = 1) +
scale_fill_manual(values = my_colors) +
theme_classic() +
labs(title = "Signature Proportions Over Time", y = "Theta", x = "Time")
# Middle: Heatmap of phi_prob
p2 <- ggplot(phi_long, aes(x = Age, y = Signature, fill = LogOdds)) +
geom_tile() +
scale_fill_gradient2(low = "blue", mid = "white", high = "red", midpoint = 0) +
theme_classic() +
labs(title = "Temporal Signature Associations for Disease", y = "Signature", x = "Age")
p2
p3 <- ggplot(contrib_long, aes(x = Time, y = Contribution, fill = Signature)) +
geom_area(position = "stack", alpha = 0.7) +
scale_fill_manual(values = my_colors) +
theme_classic() +
labs(title = "Signature Contributions to Risk", y = "Risk", x = "Time")
p3
final_plot <- p1 / p2 / p3 + plot_layout(heights = c(1, 1,1), guides = "collect") & theme(legend.position = "bottom")
print(final_plot)
length(unique(theta_long$Signature))
class(theta_long$Signature)
class(contrib_long$Signature)
levels(as.factor(contrib_long$Signature))
levels(as.factor(theta_long$Signature))
p1 <- ggplot(theta_long, aes(x = Time, y = Theta,linetype =Type, fill = Signature)) +
geom_smooth() +
#facet_wrap(~Type, ncol = 1) +
scale_fill_manual(values = my_colors) +
theme_classic() +
labs(title = "Signature Proportions Over Time", y = "Theta", x = "Time",legend=NULL)
# Middle: Heatmap of phi_prob
p2 <- ggplot(phi_long, aes(x = Age, y = Signature, fill = LogOdds)) +
geom_tile() +
scale_fill_gradient2(low = "blue", mid = "white", high = "red", midpoint = 0) +
theme_classic() +
labs(title = "Temporal Signature Associations for Disease", y = "Signature", x = "Age")
# Bottom: Stacked area plot for contributions
p3 <- ggplot(contrib_long, aes(x = Time, y = Contribution, fill = Signature)) +
geom_area(position = "stack", alpha = 0.7) +
scale_fill_manual(values = my_colors) +
theme_classic() +
labs(title = "Signature Contributions to Risk", y = "Risk", x = "Time")
final_plot <- p1 / p2 / p3 + plot_layout(heights = c(1, 1,1), guides = "collect") & theme(legend.position = "bottom")
print(final_plot)
p1 <- ggplot(theta_long, aes(x = Time, y = Theta,linetype =Type, col = Signature)) +
geom_smooth() +
#facet_wrap(~Type, ncol = 1) +
scale_col_manual(values = my_colors) +
theme_classic() +
labs(title = "Signature Proportions Over Time", y = "Theta", x = "Time",legend=NULL)
p1 <- ggplot(theta_long, aes(x = Time, y = Theta,linetype =Type, col = Signature)) +
geom_smooth() +
#facet_wrap(~Type, ncol = 1) +
scale_color_manual(values = my_colors) +
theme_classic() +
labs(title = "Signature Proportions Over Time", y = "Theta", x = "Time",legend=NULL)
# Middle: Heatmap of phi_prob
p2 <- ggplot(phi_long, aes(x = Age, y = Signature, fill = LogOdds)) +
geom_tile() +
scale_fill_gradient2(low = "blue", mid = "white", high = "red", midpoint = 0) +
theme_classic() +
labs(title = "Temporal Signature Associations for Disease", y = "Signature", x = "Age")
# Bottom: Stacked area plot for contributions
p3 <- ggplot(contrib_long, aes(x = Time, y = Contribution, fill = Signature)) +
geom_area(position = "stack", alpha = 0.7) +
scale_fill_manual(values = my_colors) +
theme_classic() +
labs(title = "Signature Contributions to Risk", y = "Risk", x = "Time")
final_plot <- p1 / p2 / p3 + plot_layout(heights = c(1, 1,1), guides = "collect") & theme(legend.position = "bottom")
print(final_plot)
p1 <- ggplot(theta_long, aes(x = Time, y = Theta,linetype =Type, col = Signature)) +
geom_smooth() +
#facet_wrap(~Type, ncol = 1) +
scale_color_manual(values = my_colors) +
theme_classic() +theme(legend.position = "none")+
labs(title = "Signature Proportions Over Time", y = "Theta", x = "Time",legend=NULL)
# Middle: Heatmap of phi_prob
p2 <- ggplot(phi_long, aes(x = Age, y = Signature, fill = LogOdds)) +
geom_tile() +
scale_fill_gradient2(low = "blue", mid = "white", high = "red", midpoint = 0) +
theme_classic() +theme(legend.position = "none")+
labs(title = "Temporal Signature Associations for Disease", y = "Signature", x = "Age")
# Bottom: Stacked area plot for contributions
p3 <- ggplot(contrib_long, aes(x = Time, y = Contribution, fill = Signature)) +
geom_area(position = "stack", alpha = 0.7) +
scale_fill_manual(values = my_colors) +
theme_classic() +
labs(title = "Signature Contributions to Risk", y = "Risk", x = "Time")
final_plot <- p1 / p2 / p3 + plot_layout(heights = c(1, 1,1), guides = "collect") & theme(legend.position = "bottom")
print(final_plot)
final_plot <- p1 / p2 / p3 + plot_layout(heights = c(1, 1,1)) & theme(legend.position = "bottom")
print(final_plot)
p1 <- ggplot(theta_long, aes(x = Time, y = Theta,linetype =Type, col = Signature)) +
geom_smooth() +
#facet_wrap(~Type, ncol = 1) +
scale_color_manual(values = my_colors) +
theme(legend.position = "none")+
labs(title = "Signature Proportions Over Time", y = "Theta", x = "Time",legend=NULL)
# Middle: Heatmap of phi_prob
p2 <- ggplot(phi_long, aes(x = Age, y = Signature, fill = LogOdds)) +
geom_tile() +
scale_fill_gradient2(low = "blue", mid = "white", high = "red", midpoint = 0) +
theme(legend.position = "none")+
labs(title = "Temporal Signature Associations for Disease", y = "Signature", x = "Age")
# Bottom: Stacked area plot for contributions
p3 <- ggplot(contrib_long, aes(x = Time, y = Contribution, fill = Signature)) +
geom_area(position = "stack", alpha = 0.7) +
scale_fill_manual(values = my_colors) +
theme_classic() +
labs(title = "Signature Contributions to Risk", y = "Risk", x = "Time")
final_plot <- p1 / p2 / p3 + plot_layout(heights = c(1, 1,1)) & theme(legend.position = "bottom")
print(final_plot)
# Top: Line plot for theta (remove both color and fill legends)
p1 <- ggplot(theta_long, aes(x = Time, y = Theta, linetype = Type, color = Signature)) +
geom_line(size = 1) +
scale_color_manual(values = my_colors) +
theme_classic() +
labs(title = "Signature Proportions Over Time", y = "Theta", x = "Time") +
theme(legend.position = "none")  # Remove all legends
# Middle: Heatmap of phi_prob (remove legend)
p2 <- ggplot(phi_long, aes(x = Age, y = Signature, fill = LogOdds)) +
geom_tile() +
scale_fill_gradient2(low = "blue", mid = "white", high = "red", midpoint = 0) +
theme_classic() +
labs(title = "Temporal Signature Associations for Disease", y = "Signature", x = "Age") +
theme(legend.position = "none")  # Remove legend
# Bottom: Stacked area plot for contributions (keep legend)
p3 <- ggplot(contrib_long, aes(x = Time, y = Contribution, fill = Signature)) +
geom_area(position = "stack", alpha = 0.7) +
scale_fill_manual(values = my_colors) +
theme_classic() +
labs(title = "Signature Contributions to Risk", y = "Risk", x = "Time") +
theme(legend.position = "bottom")
# Combine plots (no guides = "collect" needed)
final_plot <- p1 / p2 / p3 + plot_layout(heights = c(1, 1, 1))
print(final_plot)
ggsave(final_plot,"contributions.pdf",width = 10,height = 20)
ggsave(plot = final_plot,filename ="contributions.pdf",width = 10,height = 20)
