/Users/sarahurbut/aladynoulli2/pyScripts_forPublish/clust_huge_amp.py:76: UserWarning: To copy construct from a tensor, it is recommended to use sourceTensor.clone().detach() or sourceTensor.clone().detach().requires_grad_(True), rather than torch.tensor(sourceTensor).
  self.signature_refs = torch.tensor(signature_references, dtype=torch.float32)
/Users/sarahurbut/aladynoulli2/pyScripts_forPublish/clust_huge_amp.py:88: UserWarning: To copy construct from a tensor, it is recommended to use sourceTensor.clone().detach() or sourceTensor.clone().detach().requires_grad_(True), rather than torch.tensor(sourceTensor).
  self.Y = torch.tensor(Y, dtype=torch.float32)
/Users/sarahurbut/aladynoulli2/pyScripts_forPublish/clust_huge_amp.py:238: UserWarning: To copy construct from a tensor, it is recommended to use sourceTensor.clone().detach() or sourceTensor.clone().detach().requires_grad_(True), rather than torch.tensor(sourceTensor).
  event_times_tensor = torch.tensor(event_times, dtype=torch.long)

============================================================
Running Aladyn batch: samples 350000 to 360000
============================================================

Loading components...
Loaded all components successfully!
Subsetting data from 350000 to 360000...
Loading covariates data...
G_with_sex shape: (10000, 47)
Covariates loaded: 407878 total samples
Loading reference trajectories...

Initializing model with K=20 clusters...

Cluster Sizes:
Cluster 0: 5 diseases
Cluster 1: 9 diseases
Cluster 2: 14 diseases
Cluster 3: 14 diseases
Cluster 4: 17 diseases
Cluster 5: 113 diseases
Cluster 6: 9 diseases
Cluster 7: 13 diseases
Cluster 8: 8 diseases
Cluster 9: 13 diseases
Cluster 10: 12 diseases
Cluster 11: 20 diseases
Cluster 12: 29 diseases
Cluster 13: 9 diseases
Cluster 14: 18 diseases
Cluster 15: 5 diseases
Cluster 16: 15 diseases
Cluster 17: 12 diseases
Cluster 18: 7 diseases
Cluster 19: 6 diseases

Calculating gamma for k=0:
Number of diseases in cluster: 5
Base value (first 5): tensor([-13.8155, -13.8155, -13.8155, -13.8155, -13.8155])
Base value centered (first 5): tensor([-0.1196, -0.1196, -0.1196, -0.1196, -0.1196])
Base value centered mean: -3.964519692090107e-06
Gamma init for k=0 (first 5): tensor([ 0.0019, -0.0062,  0.0008,  0.0075, -0.0034])

Calculating gamma for k=1:
Number of diseases in cluster: 9
Base value (first 5): tensor([-12.7173, -13.8155, -13.8155, -11.6191, -13.8155])
Base value centered (first 5): tensor([ 0.9447, -0.1535, -0.1535,  2.0428, -0.1535])
Base value centered mean: 1.4781952017983713e-07
Gamma init for k=1 (first 5): tensor([-5.5270e-05,  1.5577e-03, -4.0413e-04, -8.4341e-03,  7.7755e-03])

Calculating gamma for k=2:
Number of diseases in cluster: 14
Base value (first 5): tensor([-13.8155, -13.8155, -13.8155, -13.8155, -12.4036])
Base value centered (first 5): tensor([-0.1785, -0.1785, -0.1785, -0.1785,  1.2334])
Base value centered mean: 3.8013459402463923e-07
Gamma init for k=2 (first 5): tensor([-0.0068,  0.0025,  0.0034, -0.0033, -0.0018])

Calculating gamma for k=3:
Number of diseases in cluster: 14
Base value (first 5): tensor([-10.2856, -13.8155, -13.8155, -13.8155, -13.8155])
Base value centered (first 5): tensor([ 3.0968, -0.4331, -0.4331, -0.4331, -0.4331])
Base value centered mean: -9.378433105666772e-07
Gamma init for k=3 (first 5): tensor([-0.0068,  0.0003, -0.0067,  0.0047, -0.0119])

Calculating gamma for k=4:
Number of diseases in cluster: 17
Base value (first 5): tensor([-12.0713, -13.8155, -13.8155, -13.2341, -13.2341])
Base value centered (first 5): tensor([ 1.6185, -0.1256, -0.1256,  0.4558,  0.4558])
Base value centered mean: -7.88307204402372e-07
Gamma init for k=4 (first 5): tensor([ 0.0036,  0.0017,  0.0010,  0.0066, -0.0019])

Calculating gamma for k=5:
Number of diseases in cluster: 113
Base value (first 5): tensor([-13.5531, -13.6406, -13.4656, -13.7280, -13.7280])
Base value centered (first 5): tensor([ 0.1474,  0.0600,  0.2349, -0.0275, -0.0275])
Base value centered mean: -1.1336326224409277e-06
Gamma init for k=5 (first 5): tensor([-0.0005, -0.0012,  0.0031,  0.0018,  0.0003])

Calculating gamma for k=6:
Number of diseases in cluster: 9
Base value (first 5): tensor([-11.6191, -13.8155, -13.8155, -13.8155, -13.8155])
Base value centered (first 5): tensor([ 1.8732, -0.3232, -0.3232, -0.3232, -0.3232])
Base value centered mean: -1.9126891857013106e-06
Gamma init for k=6 (first 5): tensor([-0.0087,  0.0071, -0.0060, -0.0001, -0.0110])

Calculating gamma for k=7:
Number of diseases in cluster: 13
Base value (first 5): tensor([-13.8155, -13.8155, -13.8155, -13.8155, -13.8155])
Base value centered (first 5): tensor([-0.1822, -0.1822, -0.1822, -0.1822, -0.1822])
Base value centered mean: 2.3603439558428363e-07
Gamma init for k=7 (first 5): tensor([ 0.0037, -0.0080, -0.0166,  0.0088,  0.0332])

Calculating gamma for k=8:
Number of diseases in cluster: 8
Base value (first 5): tensor([-13.8155, -13.8155, -13.8155, -13.8155, -13.8155])
Base value centered (first 5): tensor([-0.1143, -0.1143, -0.1143, -0.1143, -0.1143])
Base value centered mean: -1.6377449583160342e-06
Gamma init for k=8 (first 5): tensor([-0.0011,  0.0023,  0.0089,  0.0029,  0.0004])

Calculating gamma for k=9:
Number of diseases in cluster: 13
Base value (first 5): tensor([-13.0552, -10.7744, -13.8155, -13.8155, -13.8155])
Base value centered (first 5): tensor([ 0.4493,  2.7302, -0.3110, -0.3110, -0.3110])
Base value centered mean: 6.992340217948367e-07
Gamma init for k=9 (first 5): tensor([-0.0091, -0.0084, -0.0024,  0.0220, -0.0096])

Calculating gamma for k=10:
Number of diseases in cluster: 12
Base value (first 5): tensor([-13.8155, -13.8155, -12.1682, -13.8155, -13.8155])
Base value centered (first 5): tensor([-0.2259, -0.2259,  1.4214, -0.2259, -0.2259])
Base value centered mean: -1.0829925258803996e-06
Gamma init for k=10 (first 5): tensor([-0.0052, -0.0133, -0.0040, -0.0047,  0.0047])

Calculating gamma for k=11:
Number of diseases in cluster: 20
Base value (first 5): tensor([-13.3213, -13.8155, -13.8155, -13.8155, -13.8155])
Base value centered (first 5): tensor([ 0.2328, -0.2614, -0.2614, -0.2614, -0.2614])
Base value centered mean: -1.618194573893561e-06
Gamma init for k=11 (first 5): tensor([ 0.0133, -0.0009,  0.0102,  0.0107,  0.0084])

Calculating gamma for k=12:
Number of diseases in cluster: 29
Base value (first 5): tensor([-13.4747, -12.4522, -12.7931, -13.8155, -13.4747])
Base value centered (first 5): tensor([-0.2153,  0.8072,  0.4664, -0.5561, -0.2153])
Base value centered mean: 9.117126182900392e-07
Gamma init for k=12 (first 5): tensor([-0.0063,  0.0015, -0.0034,  0.0201, -0.0024])

Calculating gamma for k=13:
Number of diseases in cluster: 9
Base value (first 5): tensor([-13.8155, -13.8155, -12.7173, -13.8155, -13.8155])
Base value centered (first 5): tensor([-0.1976, -0.1976,  0.9006, -0.1976, -0.1976])
Base value centered mean: -2.3513794076279737e-06
Gamma init for k=13 (first 5): tensor([ 0.0010,  0.0070, -0.0096,  0.0048,  0.0007])

Calculating gamma for k=14:
Number of diseases in cluster: 18
Base value (first 5): tensor([-12.7173, -13.8155, -13.2664, -12.7173, -13.2664])
Base value centered (first 5): tensor([ 0.6295, -0.4687,  0.0804,  0.6295,  0.0804])
Base value centered mean: -1.6998291130221332e-06
Gamma init for k=14 (first 5): tensor([ 0.0022, -0.0015, -0.0074,  0.0074, -0.0015])

Calculating gamma for k=15:
Number of diseases in cluster: 5
Base value (first 5): tensor([-13.8155, -13.8155, -13.8155, -13.8155, -13.8155])
Base value centered (first 5): tensor([-0.1186, -0.1186, -0.1186, -0.1186, -0.1186])
Base value centered mean: -1.4549254956364166e-06
Gamma init for k=15 (first 5): tensor([-0.0067,  0.0079,  0.0046,  0.0042,  0.0082])

Calculating gamma for k=16:
Number of diseases in cluster: 15
Base value (first 5): tensor([-13.8155, -13.8155, -13.8155, -13.8155, -13.8155])
Base value centered (first 5): tensor([-0.1030, -0.1030, -0.1030, -0.1030, -0.1030])
Base value centered mean: -3.4637452017705073e-07
Gamma init for k=16 (first 5): tensor([ 0.0037, -0.0019,  0.0022,  0.0014,  0.0059])

Calculating gamma for k=17:
Number of diseases in cluster: 12
Base value (first 5): tensor([-13.8155, -13.8155, -13.8155, -13.8155, -13.8155])
Base value centered (first 5): tensor([-0.1198, -0.1198, -0.1198, -0.1198, -0.1198])
Base value centered mean: 5.092620654068014e-07
Gamma init for k=17 (first 5): tensor([ 0.0056, -0.0036,  0.0080, -0.0035, -0.0017])

Calculating gamma for k=18:
Number of diseases in cluster: 7
Base value (first 5): tensor([-13.8155, -13.8155, -13.8155, -13.8155, -13.8155])
Base value centered (first 5): tensor([-0.1734, -0.1734, -0.1734, -0.1734, -0.1734])
Base value centered mean: -1.4940261507945252e-06
Gamma init for k=18 (first 5): tensor([-0.0006,  0.0167,  0.0028, -0.0044, -0.0057])

Calculating gamma for k=19:
Number of diseases in cluster: 6
Base value (first 5): tensor([-13.8155, -13.8155, -12.1682, -13.8155, -12.1682])
Base value centered (first 5): tensor([-0.7976, -0.7976,  0.8497, -0.7976,  0.8497])
Base value centered mean: -1.0261535408062628e-06
Gamma init for k=19 (first 5): tensor([-0.0150, -0.0036,  0.0054,  0.0078, -0.0045])
Initializing with 20 disease states + 1 healthy state
Initialization complete!
Loading initial psi and clusters...

Calculating gamma for k=0:
Number of diseases in cluster: 16.0
Base value (first 5): tensor([-13.8155, -13.8155, -13.8155, -13.8155, -13.8155])
Base value centered (first 5): tensor([-0.1900, -0.1900, -0.1900, -0.1900, -0.1900])
Base value centered mean: -5.149841442175784e-08
Gamma init for k=0 (first 5): tensor([-0.0004, -0.0090, -0.0136,  0.0093,  0.0282])

Calculating gamma for k=1:
Number of diseases in cluster: 21.0
Base value (first 5): tensor([-13.3449, -12.8742, -12.4036, -13.8155, -13.8155])
Base value centered (first 5): tensor([ 0.1424,  0.6131,  1.0837, -0.3282, -0.3282])
Base value centered mean: -4.798889108315052e-07
Gamma init for k=1 (first 5): tensor([-0.0039,  0.0048,  0.0030,  0.0007, -0.0014])

Calculating gamma for k=2:
Number of diseases in cluster: 15.0
Base value (first 5): tensor([-10.5209, -13.8155, -13.8155, -13.8155, -13.8155])
Base value centered (first 5): tensor([ 2.9161, -0.3784, -0.3784, -0.3784, -0.3784])
Base value centered mean: -1.1920928955078125e-07
Gamma init for k=2 (first 5): tensor([-0.0061, -0.0019, -0.0057,  0.0069, -0.0127])

Calculating gamma for k=3:
Number of diseases in cluster: 82.0
Base value (first 5): tensor([-13.5744, -13.5744, -13.8155, -13.5744, -13.6950])
Base value centered (first 5): tensor([ 0.1376,  0.1376, -0.1035,  0.1376,  0.0171])
Base value centered mean: -2.0493507690844126e-06
Gamma init for k=3 (first 5): tensor([0.0003, 0.0008, 0.0026, 0.0020, 0.0011])

Calculating gamma for k=4:
Number of diseases in cluster: 5.0
Base value (first 5): tensor([-13.8155, -13.8155, -13.8155, -13.8155, -13.8155])
Base value centered (first 5): tensor([-0.1196, -0.1196, -0.1196, -0.1196, -0.1196])
Base value centered mean: -3.964519692090107e-06
Gamma init for k=4 (first 5): tensor([ 0.0019, -0.0062,  0.0008,  0.0075, -0.0034])

Calculating gamma for k=5:
Number of diseases in cluster: 7.0
Base value (first 5): tensor([-13.8155, -13.8155, -12.4036, -13.8155, -12.4036])
Base value centered (first 5): tensor([-0.6961, -0.6961,  0.7159, -0.6961,  0.7159])
Base value centered mean: -2.2697449821862392e-06
Gamma init for k=5 (first 5): tensor([-0.0148, -0.0021,  0.0051,  0.0070, -0.0045])

Calculating gamma for k=6:
Number of diseases in cluster: 8.0
Base value (first 5): tensor([-13.8155, -13.8155, -13.8155, -13.8155, -13.8155])
Base value centered (first 5): tensor([-0.1702, -0.1702, -0.1702, -0.1702, -0.1702])
Base value centered mean: -7.393837222480215e-07
Gamma init for k=6 (first 5): tensor([-0.0017,  0.0158,  0.0042, -0.0023, -0.0053])

Calculating gamma for k=7:
Number of diseases in cluster: 22.0
Base value (first 5): tensor([-13.8155, -12.9170, -13.3663, -13.8155, -13.3663])
Base value centered (first 5): tensor([-0.5643,  0.3342, -0.1150, -0.5643, -0.1150])
Base value centered mean: 1.269340486942383e-06
Gamma init for k=7 (first 5): tensor([-0.0066, -0.0035, -0.0072,  0.0255, -0.0022])

Calculating gamma for k=8:
Number of diseases in cluster: 28.0
Base value (first 5): tensor([-13.8155, -13.8155, -13.8155, -13.8155, -13.8155])
Base value centered (first 5): tensor([-0.1154, -0.1154, -0.1154, -0.1154, -0.1154])
Base value centered mean: -1.607131935088546e-06
Gamma init for k=8 (first 5): tensor([ 0.0040, -0.0023,  0.0044, -0.0006,  0.0021])

Calculating gamma for k=9:
Number of diseases in cluster: 12.0
Base value (first 5): tensor([-13.8155, -13.8155, -12.1682, -13.8155, -13.8155])
Base value centered (first 5): tensor([-0.2117, -0.2117,  1.4356, -0.2117, -0.2117])
Base value centered mean: -2.5444029461141326e-07
Gamma init for k=9 (first 5): tensor([-0.0039, -0.0128, -0.0060, -0.0055,  0.0064])

Calculating gamma for k=10:
Number of diseases in cluster: 11.0
Base value (first 5): tensor([-12.0185, -13.8155, -13.8155, -13.8155, -13.8155])
Base value centered (first 5): tensor([ 1.5215, -0.2755, -0.2755, -0.2755, -0.2755])
Base value centered mean: -1.0490417423625331e-07
Gamma init for k=10 (first 5): tensor([-0.0074,  0.0068, -0.0075,  0.0013, -0.0082])

Calculating gamma for k=11:
Number of diseases in cluster: 8.0
Base value (first 5): tensor([-13.8155, -13.8155, -13.8155, -13.8155, -13.8155])
Base value centered (first 5): tensor([-0.1143, -0.1143, -0.1143, -0.1143, -0.1143])
Base value centered mean: -1.6377449583160342e-06
Gamma init for k=11 (first 5): tensor([-0.0011,  0.0023,  0.0089,  0.0029,  0.0004])

Calculating gamma for k=12:
Number of diseases in cluster: 7.0
Base value (first 5): tensor([-10.9916, -13.8155, -13.8155, -13.8155, -13.8155])
Base value centered (first 5): tensor([ 2.7252, -0.0987, -0.0987, -0.0987, -0.0987])
Base value centered mean: -2.056121815030565e-07
Gamma init for k=12 (first 5): tensor([0.0022, 0.0014, 0.0031, 0.0056, 0.0033])

Calculating gamma for k=13:
Number of diseases in cluster: 13.0
Base value (first 5): tensor([-13.8155, -13.8155, -13.8155, -13.8155, -12.2949])
Base value centered (first 5): tensor([-0.1731, -0.1731, -0.1731, -0.1731,  1.3474])
Base value centered mean: -3.2739640687395877e-07
Gamma init for k=13 (first 5): tensor([-0.0065,  0.0022,  0.0041, -0.0039, -0.0014])

Calculating gamma for k=14:
Number of diseases in cluster: 10.0
Base value (first 5): tensor([-12.8271,  -9.8620, -13.8155, -13.8155, -13.8155])
Base value centered (first 5): tensor([ 0.7080,  3.6731, -0.2804, -0.2804, -0.2804])
Base value centered mean: -1.2359619177004788e-06
Gamma init for k=14 (first 5): tensor([-0.0046, -0.0101, -0.0055,  0.0209, -0.0071])

Calculating gamma for k=15:
Number of diseases in cluster: 5.0
Base value (first 5): tensor([-13.8155, -13.8155, -11.8388, -13.8155, -13.8155])
Base value centered (first 5): tensor([-0.2892, -0.2892,  1.6875, -0.2892, -0.2892])
Base value centered mean: -1.4965057744120713e-06
Gamma init for k=15 (first 5): tensor([ 3.1016e-03,  3.2328e-03, -7.5500e-03,  4.9347e-03, -3.1581e-05])

Calculating gamma for k=16:
Number of diseases in cluster: 29.0
Base value (first 5): tensor([-13.4747, -13.8155, -13.8155, -13.8155, -13.4747])
Base value centered (first 5): tensor([ 0.0900, -0.2508, -0.2508, -0.2508,  0.0900])
Base value centered mean: -1.5101433064046432e-06
Gamma init for k=16 (first 5): tensor([0.0063, 0.0004, 0.0089, 0.0122, 0.0068])

Calculating gamma for k=17:
Number of diseases in cluster: 17.0
Base value (first 5): tensor([-12.6527, -13.8155, -13.2341, -12.6527, -13.2341])
Base value centered (first 5): tensor([ 0.7391, -0.4237,  0.1577,  0.7391,  0.1577])
Base value centered mean: -8.510589850629913e-07
Gamma init for k=17 (first 5): tensor([ 0.0017, -0.0023, -0.0099,  0.0054, -0.0016])

Calculating gamma for k=18:
Number of diseases in cluster: 9.0
Base value (first 5): tensor([-12.7173, -13.8155, -13.8155, -11.6191, -13.8155])
Base value centered (first 5): tensor([ 0.9447, -0.1535, -0.1535,  2.0428, -0.1535])
Base value centered mean: 1.4781952017983713e-07
Gamma init for k=18 (first 5): tensor([-5.5270e-05,  1.5577e-03, -4.0413e-04, -8.4341e-03,  7.7755e-03])

Calculating gamma for k=19:
Number of diseases in cluster: 23.0
Base value (first 5): tensor([-12.9561, -13.8155, -12.5263, -13.8155, -13.8155])
Base value centered (first 5): tensor([ 0.7007, -0.1587,  1.1304, -0.1587, -0.1587])
Base value centered mean: -5.579948378908739e-07
Gamma init for k=19 (first 5): tensor([ 0.0023, -0.0028,  0.0063,  0.0020, -0.0066])
Initializing with 20 disease states + 1 healthy state
Initialization complete!
Clusters match exactly: True

Training model for 200 epochs...
Learning rate: 0.1, Lambda: 0.01

Epoch 0
Loss: 17.4269

Monitoring signature responses:

Disease 161 (signature 7, LR=32.20):
  Theta for diagnosed: 0.150 ± 0.037
  Theta for others: 0.147
  Proportion difference: 0.002

Disease 76 (signature 7, LR=30.76):
  Theta for diagnosed: 0.151 ± 0.038
  Theta for others: 0.148
  Proportion difference: 0.003

Disease 260 (signature 8, LR=30.41):
  Theta for diagnosed: 0.096 ± 0.080
  Theta for others: 0.087
  Proportion difference: 0.008

Disease 347 (signature 3, LR=29.44):
  Theta for diagnosed: 0.149 ± 0.070
  Theta for others: 0.150
  Proportion difference: -0.001
